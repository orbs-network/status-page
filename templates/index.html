<!DOCTYPE html>
<html>
<head>
    <title>Status page</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,600,700,800,900" rel="stylesheet">
    <style>
        body {
            font-family: "montserrat", "HelveticaNeue", "Helvetica Neue", "Helvetica-Neue", Helvetica, Arial, sans-serif;
            background-color: #06142e;
            color: white;
        }

        td {
            padding: 10px;
        }

        td a {
            font-size: 13px;
            color: aliceblue;
        }

        .green {
            background-color: #66bb6a;
        }

        .red {
            background-color: #d32f2f;
        }

        .yellow {
            background-color: gold;
        }

        html, body { margin: 0; padding: 0; }
        
        .centeredDiv { 
            margin-right: auto;
            margin-left: auto;
            width: <%= (_.size(vchains) + 1) * 150 %>px;
        }

        .centeredDiv table {
            width: 100%;
        }

        .node-name {
            font-size: 13px;
        }

        .header img {
            max-height: 70px;
            padding: 10px;
            padding-left: 20px;
            vertical-align: middle;
            float: left;
        }

        .header h1 {
            font-size: 60px;
            font-weight: 300;
            line-height: 60px;
            text-align: center;
        }

        .invisible {
            display: none;
        }

        .settings {
            font-family:  'Courier New', Courier, monospace;
        }
    </style>

    <script>
        function toggleSettings(idx) {
            document.querySelector("#settings-pane-" + idx).classList.toggle("invisible");
        }
    </script>
</head>
<body>
    <div class="centeredDiv">
        <div class="header">
            <img src="0RBS-white-version.png">
            <h1>
            Node Status
            </h1>
        </div>
        <table>
            <tr>
                <td><!-- empty space --></td>
                <% _.forEach(vchains, (vcid) => {%>
                    <td><%= vcid %></td>
                <% }) %>
            </tr>
        
            <% _.forEach(_.keys(state), (node, idx) => {%>
            <tr>
                <td class="node-name"><%= node %></td>
                <% _.forEach(vchains, (vcid) => {
                    const data = _.get(state, `${node}.${vcid}`);
                    const { blockHeight, status, version, commit } = data;
                    const shortCommit = !_.isEmpty(commit) ? commit.substring(0, 8) : "";
                    const githubLink = `https://github.com/orbs-network/orbs-network-go/commit/${shortCommit}`;
                    const metricsLink = `http://${getEndpoint(_.find(ips, { name: node }).host, vcid)}/metrics`;
                %>
                    <td class="<%= status || 'yellow' %>">
                        <% if (!data || _.isEmpty(data) || (!version && blockHeight == 0)) { %> 
                            <a href="<%= metricsLink %>">no data</a>
                        <% } else { %>
                            <a href="<%= metricsLink %>"><%= blockHeight %></a>
                            <br/><a href="<%= githubLink %>" alt="<%= version %> <%= shortCommit %>"><%= version %></a>
                        <% } %>
                    </td>
                <% }) %>
                <td class="settings"><a href="#" onclick="toggleSettings(<%= idx %>)" alt="SDK connection settings"><img src="icons8-settings.svg"></a></td>
            </tr>
            <tr id="settings-pane-<%= idx %>" class="invisible">
                <td class="node-name"></td>
                <td colspan="<%= vchains.length %>" class="settings">
                # connection settings <br/>
                <% _.forEach(vchains, (vcid) => { 
                    const endpoint = `http://${getEndpoint(_.find(ips, { name: node }).host, vcid)}`
                %>
                    ORBS_VCHAIN=<%= vcid %><br/>
                    ORBS_NODE_ADDRESS=<%= endpoint %><br/><br/>
                <% }) %>

                // connection settings as json

                <% _.forEach(vchains, (vcid) => { 
                    const settings = JSON.stringify({
                        vchain: vcid,
                        endpoint: `http://${getEndpoint(_.find(ips, { name: node }).host, vcid)}`,
                    }, 2, 2)
                %>
                    <pre><%= settings %></pre>
                <% }) %>
                </td>
            </tr>
            <% }) %>    
        </table>                
    </div>
</body>
</html>
